# Wallet API

Wallet API — это REST API, разработанное на Python с использованием FastAPI для управления кошельками пользователей. Оно поддерживает создание кошельков, получение информации о кошельке, а также операции пополнения (`DEPOSIT`) и снятия средств (`WITHDRAW`) с обеспечением конкурентности через блокировку строк (`SELECT ... FOR UPDATE`). API использует PostgreSQL в разработке и SQLite в тестах, асинхронный доступ к базе данных через SQLAlchemy с драйвером `asyncpg` и тестирование с использованием `pytest` и `pytest-asyncio`.

## Основные возможности

- **Создание кошелька**: Регистрация нового кошелька с уникальным email и начальным балансом.
- **Получение информации о кошельке**: Запрос данных о кошельке по его UUID, включая баланс и email.
- **Операции с балансом**:
  - Пополнение (`DEPOSIT`): Увеличение баланса кошелька.
  - Снятие (`WITHDRAW`): Уменьшение баланса с проверкой на достаточность средств.
- **Конкурентность**: Использование `SELECT ... FOR UPDATE` для предотвращения race condition при операциях с балансом.
- **Валидация**: Проверка входных данных (например, `amount > 0`) через Pydantic.
- **Логирование**: Логирование операций и ошибок для мониторинга и отладки.
- **Тестирование**: Полное покрытие тестами с использованием `pytest-asyncio`, включая проверку успешных операций, ошибок и конкурентности.
- **Соответствие PEP 8**: Код следует стандартам Python.

## Технологии

- **Язык**: Python 3.13
- **Фреймворк**: FastAPI
- **ORM**: SQLAlchemy (асинхронный режим с `asyncpg` для PostgreSQL и `aiosqlite` для тестов)
- **База данных**:
  - Продакшен: PostgreSQL
  - Тесты: SQLite в памяти
- **Тестирование**: `pytest`, `pytest-asyncio`, `httpx`
- **Валидация**: Pydantic
- **Логирование**: Python `logging`
- **Контейнеризация**: Docker (опционально, с `docker-compose` для PostgreSQL)

## Установка

### Требования

- Python 3.13
- UV (опционально, пакетный менеджер Python)
- Docker (опционально, для запуска базы данных)

### Установка зависимостей

1. Склонируйте репозиторий:

   ```bash
   git clone git@github.com:BotalovSerg/test-rest-app-fastapi.git
   cd test-rest-app-fastapi
   ```

2. Создайте виртуальное окружение и активируйте его:

   ```bash
   python -m venv .venv       # Создать через venv
   uv venv                    # Или создать uv
   source .venv/bin/activate  # Linux/MacOS
   .venv\Scripts\activate     # Windows
   ```

3. Установите зависимости:

   ```bash
   pip install -r requirements.txt  # Установить через venv
   uv sync                          # Установить через uv
   ```

4. Запустить через docker compose:

    ```bash
    docker compose up --build -d
    ```
